  
{% extends 'base.html' %}

{% block content %}

    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.54.0/mapbox-gl.js'></script>

  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.54.0/mapbox-gl.css' rel='stylesheet' />

  <style>
    body { margin:0; padding:0; }
    #map { position:absolute; top:0; bottom:0; width:100%; }
  </style>

     <!-- remove later! just for playing around purposes -->
    <style>

        .calc-route-btn {
            background-color: rgba(255, 255, 255, .9);
            position: absolute;
            height: 75px;
            width: 150px;   
        } 

        .calc-route-btn:hover {
            background-color: #4CAF50; /* Green */
            color: white;
        }

        .change-style-b{
            position: fixed;
            bottom: 0;
            right: 0;
            height: 75px;
            width: 150px;
        }

        .change-style-b:hover {
            background-color: #fd5e79;
            color: white;
        }

        .change-style-s{
            position: fixed;
            bottom: 0;
            right: -5;
            height: 75px;
            width: 150px;
        }

        .change-style-s:hover {
            background-color: black;
            color: white;
        }

    </style>

</head>

<body>

 

    <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.css' type='text/css'/>

    <div id='map'></div>

    <div id='calc-route'> 

        <button type='button' id='calcuate-route-btn' class='calc-route-btn' style="display:none;"> 
            Calculate Route  
        </button>"

    </div>

    <div id='set-map-style-baloon'>
        
        <button type='button' id='change-style-b' class='change-style-b'> 
           Baloonicornize!
        </button>" 

    </div>

    <div id='set-map-style-sat'>
        
        <button type='button' id='change-style-s' class='change-style-s'> 
           Satellite
        </button>" 

    </div>

</body>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoicGFpZ2VlbW9vZHkiLCJhIjoiY2owbDcyejhvMDJwNzJ5cDR0YXE1aG10MCJ9.a-JLnrmMPSJNwOGQdloTDA';


// LOAD MAP 
var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/mapbox/satellite-v9', //hosted style id
    center: [-122.400932, 37.758250], // starting position is balloonicorn example route centr
    zoom: 16 // starting zoom
});


// DRAW BBOX 

let bboxGeometry = {}

var draw = new MapboxDraw({

    displayControlsDefault: false,

    controls: {
        polygon: true,
        trash: true
    }

}); 

map.addControl(draw);
 
map.on('draw.create', updateStatus);
// map.on('draw.delete', updateStatus);
// map.on('draw.update', updateStatus);
 
function updateStatus(e) {

    let data = draw.getAll();

    console.log(calcRouteBtn)

    if (data.features.length > 0) {

        bboxGeometry = JSON.stringify(data)

        drawnFeatureCollection = (JSON.stringify(data))

        $('#calcuate-route-btn').removeAttr('style');
    } 

    else {

        if (e.type !== 'draw.delete') alert("Use the draw tools to draw a polygon!");
    }
}

//GET ROUTE CALCULATION

const calcRouteBtn = $('#calcuate-route-btn');

calcRouteBtn.on('click', function() {

    const url = 'http://0.0.0.0:5000/route_geometry.geojson';

    map.addSource('route', { type: 'geojson', data: url});

    map.addLayer({
        "id": "route", // rename?
        "type": "line",
        "source": "route", 
        "paint": {
            "line-color": "#FF0000",
            "line-width": 8
        }
    });

    // hide claculate button again
    $('#calcuate-route-btn').attr('style','display:none ;');

    // remove tools for adding new bbox
    map.removeControl(draw);


});


$('#change-style-b').on('click', function() {
   
        map.setStyle('mapbox://styles/paigeemoody/cjve0tvkzhbdf1fpacmnwbc88')
    });

$('#change-style-s').on('click', function() {
   
        map.setStyle('mapbox://styles/mapbox/satellite-v9')
    });

map.addControl(new mapboxgl.GeolocateControl({
    positionOptions: {
        enableHighAccuracy: true
    },
    trackUserLocation: true
}));

</script>

</body>

{% endblock %}



